<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="600"> <!-- Auto-refresh every 10 minutes (600 seconds) -->
    <title>Senarai Event & Seminar Percuma</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #f39c12;
            --warning-color: #e74c3c;
            --whatsapp-color: #25D366;
            --text-color: #333;
            --light-bg: #f5f5f5;
            --card-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: var(--card-shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .filter-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .filter-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .category-btn {
            padding: 8px 16px;
            background-color: white;
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .category-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .category-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .event-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
        }
        
        .event-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
        }
        
        .event-status.open {
            background-color: #27ae60;
        }
        
        .event-content {
            padding: 20px;
        }
        
        .event-category {
            display: inline-block;
            padding: 3px 10px;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .event-title {
            font-size: 1.4rem;
            color: var(--primary-color);
            line-height: 1.3;
            flex-grow: 1;
            margin-right: 10px;
        }
        
        .event-capacity {
            background-color: var(--accent-color);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .event-info {
            margin-bottom: 15px;
        }
        
        .event-info p {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .event-info i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .event-price {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin: 10px 0;
        }
        
        .event-desc {
            margin-bottom: 20px;
            color: #666;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .register-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            text-align: center;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .register-btn:hover {
            background-color: #e67e22;
        }
        
        .requirements {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .requirements h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .requirements ul {
            list-style-type: none;
            padding-left: 5px;
        }
        
        .requirements li {
            margin-bottom: 10px;
            padding-left: 25px;
            position: relative;
        }
        
        .requirements li:before {
            content: "✓";
            color: var(--secondary-color);
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .inquiry-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 40px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }
        
        .inquiry-section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .inquiry-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full-width {
            grid-column: span 2;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            height: 120px;
            resize: vertical;
        }
        
        .whatsapp-btn {
            grid-column: span 2;
            padding: 15px;
            background-color: var(--whatsapp-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background-color 0.3s ease;
        }
        
        .whatsapp-btn:hover {
            background-color: #128C7E;
        }
        
        .whatsapp-icon {
            font-size: 1.4rem;
        }
        
        .no-events {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--primary-color);
        }
        
        .last-update {
            text-align: right;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
        }
        
        @media (max-width: 768px) {
            .events-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .inquiry-form {
                grid-template-columns: 1fr;
            }
            
            .form-group.full-width {
                grid-column: span 1;
            }
            
            .whatsapp-btn {
                grid-column: span 1;
            }
        }
        
        @media (max-width: 480px) {
            .events-grid {
                grid-template-columns: 1fr;
            }
            
            .category-filters {
                justify-content: center;
            }
            
            .event-header {
                flex-direction: column;
            }
            
            .event-capacity {
                margin-top: 5px;
                align-self: flex-start;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Senarai Event & Seminar Percuma</h1>
            <p class="subtitle">Tingkatkan ilmu dan kemahiran anda dengan seminar percuma!</p>
        </div>
    </header>
    
    <div class="container">
        <!-- Syarat-syarat Penyertaan -->
        <div class="requirements">
            <h2>Syarat-syarat Penyertaan:</h2>
            <ul>
                <li>Setiap program ada versi percuma dan berbayar. Sila semak butiran kursus.</li>
                <li>Terbuka kepada semua warganegara Malaysia berumur 18 tahun dan ke atas.</li>
                <li>Peserta dikehendaki mendaftar melalui borang pendaftaran yang disediakan sebelum tarikh tutup.</li>
                <li>Tempat adalah terhad dan akan diberi keutamaan kepada pendaftaran terawal.</li>
                <li>Peserta perlu hadir tepat pada masanya untuk mengesahkan pendaftaran.</li>
                <li>Sijil penyertaan hanya akan diberi kepada peserta yang hadir sepanjang program.</li>
            </ul>
        </div>
        
        <div class="filter-container">
            <h2 class="filter-title">Filter mengikut kategori:</h2>
            <div class="category-filters" id="categoryFilters">
                <button class="category-btn active" data-category="semua">Semua</button>
                <!-- Kategori akan dijana secara automatik -->
            </div>
        </div>
        
        <div id="loading" class="loading">Memuat data...</div>
        
        <div class="events-grid" id="eventsGrid">
            <!-- Event cards akan dijana secara automatik -->
        </div>
        
        <div class="last-update" id="lastUpdate">
            Kemas kini terakhir: <span id="updateTime">-</span>
        </div>
        
        <!-- Bahagian Pertanyaan -->
        <div class="inquiry-section">
            <h2>Ada Pertanyaan?</h2>
            <div class="inquiry-form">
                <div class="form-group">
                    <label for="name">Nama</label>
                    <input type="text" id="name" name="name" placeholder="Nama penuh anda">
                </div>
                <div class="form-group">
                    <label for="phone">No. Telefon</label>
                    <input type="text" id="phone" name="phone" placeholder="Contoh: 01xxxxxxxx">
                </div>
                <div class="form-group">
                    <label for="email">E-mel</label>
                    <input type="email" id="email" name="email" placeholder="E-mel anda">
                </div>
                <div class="form-group">
                    <label for="eventInterest">Kursus Yang Diminati</label>
                    <input type="text" id="eventInterest" name="eventInterest" placeholder="Nama kursus/seminar">
                </div>
                <div class="form-group full-width">
                    <label for="message">Pertanyaan</label>
                    <textarea id="message" name="message" placeholder="Sila nyatakan pertanyaan anda..."></textarea>
                </div>
                <button type="button" class="whatsapp-btn" onclick="sendWhatsAppMessage()">
                    <span class="whatsapp-icon">📱</span> Hantar Pertanyaan melalui WhatsApp
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // URL Google Sheets CSV - Google Sheets published as CSV URL
        // Change format from /pubhtml to /pub?output=csv
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQh9oseGP-l6MnaLcY8fdaNs6xJA747DA0fTJ5itGIRrPWip7p01zMUo1ufWCGGq7WGA0_VsfmRPkjt/pub?output=csv';
        
        // Sample event data for demonstration
        const sampleEvents = [
            {
                title: "Bengkel Asas Digital Marketing",
                category: "Digital Marketing",
                date: "2025-03-10",
                time: "10:00 - 13:00",
                location: "Online (Zoom)",
                description: "Belajar asas-asas digital marketing untuk perniagaan anda. Topik meliputi SEO, Media Sosial, Email Marketing dan Google Ads.",
                price: "Percuma",
                capacity: "30 orang",
                registrationUrl: "https://forms.google.com/xyz",
                status: "open"
            },
            {
                title: "Seminar Motivasi Kejayaan Dalam Bisnes",
                category: "Motivasi",
                date: "2025-03-15",
                time: "14:00 - 16:30",
                location: "Hotel Grand Millennium, KL",
                description: "Seminar motivasi khas untuk usahawan yang ingin mencapai kejayaan dalam perniagaan. Dapatkan tips dari usahawan berjaya.",
                price: "Percuma",
                capacity: "100 orang",
                registrationUrl: "https://forms.google.com/abc",
                status: "open"
            },
            {
                title: "Webinar: Asas Perakaunan Untuk Peniaga Kecil",
                category: "Bisnes",
                date: "2025-03-20",
                time: "19:00 - 21:00",
                location: "Online (Microsoft Teams)",
                description: "Belajar cara menguruskan kewangan perniagaan anda dengan betul. Pengurusan aliran tunai, rekod perbelanjaan dan asas cukai.",
                price: "Percuma",
                capacity: "50 orang",
                registrationUrl: "https://forms.google.com/def",
                status: "open"
            },
            {
                title: "Kursus Asas Membuat Kek dan Pastri",
                category: "Bakery",
                date: "2025-03-25",
                time: "10:00 - 14:00",
                location: "Pusat Komuniti Taman Melawati",
                description: "Belajar asas membuat kek dan pastri daripada chef profesional. Teknik, bahan dan tips untuk hasil yang sempurna.",
                price: "Percuma",
                capacity: "50 orang",
                registrationUrl: "https://forms.google.com/ghi",
                status: "open"
            }
        ];
        
        // Variables
        let allEvents = [];
        let categories = new Set();
        let currentFilter = 'semua';
        let lastUpdated = new Date();
        
        // DOM elements
        const eventsGrid = document.getElementById('eventsGrid');
        const categoryFilters = document.getElementById('categoryFilters');
        const loadingElement = document.getElementById('loading');
        const updateTimeElement = document.getElementById('updateTime');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            initApp();
            
            // Set auto-refresh every 10 minutes
            setInterval(fetchEvents, 10 * 60 * 1000);
        });
        
        function initApp() {
            console.log("Initializing app...");
            if (SHEET_URL) {
                fetchEvents();
            } else {
                // Use sample data for demonstration
                processEvents(sampleEvents);
                loadingElement.style.display = 'none';
            }
            
            // For debugging - remove in production
            console.log("Attempting to fetch data from:", SHEET_URL);
        }
        
        function fetchEvents() {
            if (!SHEET_URL) {
                return;
            }
            
            loadingElement.style.display = 'block';
            loadingElement.textContent = 'Memuat data...';
            
            console.log("Fetching data from:", SHEET_URL);
            
            // Add cache busting parameter to avoid caching issues
            const cacheBuster = new Date().getTime();
            const urlWithCacheBuster = SHEET_URL + (SHEET_URL.includes('?') ? '&' : '?') + '_cb=' + cacheBuster;
            
            Papa.parse(urlWithCacheBuster, {
                download: true,
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    console.log("Data berhasil diambil:", results);
                    
                    // Debug: Display raw field values
                    if (results.data && results.data.length > 0) {
                        console.log("Sample data record:", results.data[0]);
                        console.log("Field names:", results.meta.fields);
                    }
                    
                    // Jika tiada data atau error
                    if (!results.data || results.data.length === 0) {
                        console.error("Tiada data diambil dari Google Sheets");
                        loadingElement.textContent = 'Tiada data tersedia. Sila semak Google Sheets anda.';
                        
                        // Gunakan data sampel jika tiada data dari Google Sheets
                        processEvents(sampleEvents);
                        return;
                    }
                    
                    // Process valid data
                    processEvents(results.data);
                    loadingElement.style.display = 'none';
                    lastUpdated = new Date();
                    updateTimeElement.textContent = formatDateTime(lastUpdated);
                },
                error: function(error) {
                    console.error('Error fetching data:', error);
                    loadingElement.textContent = 'Ralat memuat data. Sila muat semula halaman.';
                    
                    // Gunakan data sampel jika gagal ambil data
                    processEvents(sampleEvents);
                }
            });
        }
        
        function processEvents(events) {
            // Handle empty or invalid data
            if (!events || events.length === 0) {
                console.error("No events data available");
                return;
            }
            
            console.log("Processing events:", events);
            
            // Clean up data: ignore empty rows and handle incorrect data formats
            allEvents = events.filter(event => {
                // Check if event has at least a title (minimum viable data)
                return event && event.title && event.title.trim().length > 0;
            });
            
            // Filter out closed events (only show "open" or events without status)
            allEvents = allEvents.filter(event => {
                // If event has status and it's "closed", filter it out
                return !event.status || event.status.toLowerCase() !== "closed";
            });
            
            console.log("Filtered events:", allEvents);
            
            // Extract unique categories
            categories = new Set(['semua']);
            allEvents.forEach(event => {
                if (event.category && event.category.trim()) {
                    categories.add(event.category.trim());
                }
            });
            
            console.log("Categories found:", Array.from(categories));
            
            // Create category filters
            createCategoryFilters();
            
            // Display events
            displayEvents();
            
            // Update last refresh time
            updateTimeElement.textContent = formatDateTime(lastUpdated);
        }
        
        function createCategoryFilters() {
            // Clear existing filters except "All"
            while (categoryFilters.children.length > 1) {
                categoryFilters.removeChild(categoryFilters.lastChild);
            }
            
            // Add category buttons
            categories.forEach(category => {
                if (category === 'semua') return; // Skip 'All' as it's already added
                
                const btn = document.createElement('button');
                btn.className = 'category-btn';
                btn.textContent = category;
                btn.dataset.category = category;
                
                btn.addEventListener('click', () => {
                    setActiveCategory(category);
                });
                
                categoryFilters.appendChild(btn);
            });
        }
        
        function setActiveCategory(category) {
            currentFilter = category;
            
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                }
            });
            
            // Re-display events with filter
            displayEvents();
        }
        
        function displayEvents() {
            // Clear events grid
            eventsGrid.innerHTML = '';
            
            // Filter events
            let filteredEvents = allEvents;
            if (currentFilter !== 'semua') {
                filteredEvents = allEvents.filter(event => event.category === currentFilter);
            }
            
            // Display events or "no events" message
            if (filteredEvents.length === 0) {
                const noEvents = document.createElement('div');
                noEvents.className = 'no-events';
                noEvents.textContent = 'Tiada event dalam kategori ini buat masa sekarang.';
                eventsGrid.appendChild(noEvents);
                return;
            }
            
            // Create event cards
            filteredEvents.forEach(event => {
                const eventCard = createEventCard(event);
                eventsGrid.appendChild(eventCard);
            });
        }
        
        function createEventCard(event) {
            const card = document.createElement('div');
            card.className = 'event-card';
            
            // Log event details for debugging
            console.log("Creating card for event:", event.title);
            
            // Handle missing data with safe defaults
            const title = event.title || 'Tiada Tajuk';
            const category = event.category || 'Umum';
            const date = event.date ? formatDate(event.date) : 'TBA';
            const time = event.time || 'TBA';
            const location = event.location || 'TBA';
            const price = event.price || 'Percuma';
            const description = event.description || 'Tiada deskripsi tersedia';
            const registrationUrl = event.registrationUrl || '#';
            const capacity = event.capacity || 'Terhad';
            const closeDate = event.closeDate ? formatDate(event.closeDate) : 'Sehingga tempat penuh';
            
            // Add a status badge if status is provided
            let statusHtml = '';
            if (event.status && event.status.toLowerCase() === 'open') {
                statusHtml = '<span class="event-status open">Open</span>';
            }
            
            // Create content element
            const contentElement = document.createElement('div');
            contentElement.className = 'event-content';
            contentElement.innerHTML = `
                ${statusHtml}
                <span class="event-category">${category}</span>
                <div class="event-header">
                    <h3 class="event-title">${title}</h3>
                    <span class="event-capacity">${capacity}</span>
                </div>
                <div class="event-info">
                    <p><i>📅</i> Tarikh: ${date}</p>
                    <p><i>⏰</i> Masa: ${time}</p>
                    <p><i>📍</i> Lokasi: ${location}</p>
                    <p><i>🔔</i> Tarikh Tutup: ${closeDate}</p>
                </div>
                <div class="event-price">${price}</div>
                <p class="event-desc">${description}</p>
                <a href="${registrationUrl}" target="_blank" class="register-btn">Daftar Sekarang</a>
            `;
            
            // Add elements to card
            card.appendChild(contentElement);
            
            return card;
        }
        
        function formatDate(dateStr) {
            if (!dateStr) return 'TBA';
            
            try {
                // Check if dateStr is already a Date object
                if (dateStr instanceof Date) {
                    return dateStr.toLocaleDateString('ms-MY', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                }
                
                // Try to parse the date string
                const date = new Date(dateStr);
                
                // Check if date is valid
                if (isNaN(date.getTime())) {
                    console.warn(`Invalid date: ${dateStr}`);
                    return dateStr; // Return the original string if invalid
                }
                
                return date.toLocaleDateString('ms-MY', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            } catch (e) {
                console.error(`Error formatting date: ${dateStr}`, e);
                return dateStr;
            }
        }
        
        function formatDateTime(date) {
            try {
                return date.toLocaleDateString('ms-MY', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                console.error("Error formatting datetime:", e);
                return date.toString();
            }
        }
        
        function sendWhatsAppMessage() {
            // Get form values
            const name = document.getElementById('name').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const email = document.getElementById('email').value.trim();
            const eventInterest = document.getElementById('eventInterest').value.trim();
            const message = document.getElementById('message').value.trim();
            
            // Validate form
            if (!name || !message) {
                alert('Sila masukkan nama dan pertanyaan anda.');
                return;
            }
            
            // Prepare WhatsApp message
            const adminPhone = '+601169887631'; // Your WhatsApp number
            
            let whatsappMessage = `🔔 *PERTANYAAN SEMINAR/KURSUS* 🔔\n\n`;
            whatsappMessage += `*Nama:* ${name}\n`;
            
            if (phone) whatsappMessage += `*No. Telefon:* ${phone}\n`;
            if (email) whatsappMessage += `*E-mel:* ${email}\n`;
            if (eventInterest) whatsappMessage += `*Kursus Yang Diminati:* ${eventInterest}\n`;
            
            whatsappMessage += `\n*Pertanyaan:*\n${message}`;
            
            // Encode for URL
            const encodedMessage = encodeURIComponent(whatsappMessage);
            
            // Open WhatsApp with the prepared message
            window.open(`https://wa.me/${adminPhone}?text=${encodedMessage}`, '_blank');
        }
        
        // Initialize by setting "All" category as active
        document.querySelector('.category-btn[data-category="semua"]').addEventListener('click', () => {
            setActiveCategory('semua');
        });
    </script>
</body>
</html>
